{% extends "wrapper.html" %}

{% block content %}
<section class="region-result">
    <div class="container">

        <h2 style="text-decoration: underline">Result for region:</h2><br>
        <div class="filters">
          <div class="btn-toolbar" role="toolbar" aria-label="Конфигурация данных">
              <div class="btn-group mr-2" role="group" aria-label="Фильтры">
                <button type="button" id="whithout" class="btn btn-secondary active">Без фильтров</button>
                <button type="button" id="genders" class="btn btn-secondary">Разделение по гендеру</button>
                <button type="button" id="parts" class="btn btn-secondary">Разделение по партии</button>
              </div>
              <div class="btn-group mr-2" role="group" aria-label="Семья">
                <form>
                    <button name="family" type="submit" value="{% if family %} 0 {% else %} 1 {% endif %}" class="btn btn-secondary {% if family %} active {% endif %}">Учитывать семью</button>
                </form>
              </div>
            </div>

            <p>
                <label for="amount">Choose gap:</label>
                <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
            </p>

            <div id="slider-range" style="height:10px; width: 40%"></div>


        </div><br><br>

        <div class="row">
            <div class="col-md-6">
                <h4 style="text-align: center">Avarege salary</h4>
                <canvas id="salary_mw" width="400px" height="300px"></canvas><br>
                <div class="alert alert-info" role="alert">
                    Everything is OK. Click to see more.
                </div><br>
            </div>
            <div class="col-md-6">
                <h4 style="text-align: center">Savings</h4>
                <canvas id="savings" width="400px" height="300px"></canvas><br>
                <div class="alert alert-info" role="alert">
                    Everything is OK. Click to see more.
                </div><br>
            </div>
            <div class="col-md-6">
                <h4 style="text-align: center">Cars</h4>
                <canvas id="cars" width="400px" height="300px"></canvas><br>
            </div>
            <div class="col-md-6">
                <h4 style="text-align: center">Flat square</h4>
                <canvas id="square" width="400px" height="300px"></canvas><br>
                <div class="alert alert-info" role="alert">
                    Everything is OK. Click to see more.
                </div><br>
            </div>
        </div>

    </div>



</section>
<script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}">

</script>
<script type="text/javascript">
    var mode = 'wh'

    window.mode = mode


    window.from = 1990
    window.to = 2019


    savings(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

    flat(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

    cars(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

    salary(window.mode, {{avarage_salary}}, {{years}}, null, null, window.from, window.to, null)


    $(function() {
        var a = 1990
        b = 2019
        window.from = 1990
        window.to = 2019

        $("#slider-range").slider({
            orientation: "horizontal",
            range: true,
            values: [0, 100],
            slide: function(event, ui) {
                $("#amount").val(Math.round(a + (b - a) * (ui.values[0] / 100)) + " год" + "-" + Math.round(a + (b - a) * (ui.values[1] / 100)) + " год");
                var from = (parseInt($("#amount").val()[0] + $("#amount").val()[1] + $("#amount").val()[2] + $("#amount").val()[3]))
                    to = (parseInt($("#amount").val()[9] + $("#amount").val()[10] + $("#amount").val()[11] + $("#amount").val()[12]))

                window.to = to
                window.from = from


                if (window.mode == 'wh') {

                    savings(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

                    flat(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

                    cars(window.mode, [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)

                    salary(window.mode, {{avarage_salary}}, {{years}}, null, null, window.from, window.to, null)

                } else if (window.mode == "mw") {
                    savings('mw', null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, window.from, window.to, null)
                    flat('mw', null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, window.from, window.to, null)
                    cars('mw', null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, window.from, window.to, null)
                    salary('mw', null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, window.from, window.to, null)
                } else if (window.mode == 'part') {
                    var part_names = {{part_names | safe}}
                    part_salaries = {{part_salaries | safe}}



                    savings('parts', part_salaries, {{years}}, null, null, from, to, part_names)
                    flat('parts', part_salaries, {{years}}, null, null, from, to, part_names)
                    cars('parts', part_salaries, {{years}}, null, null, from, to, part_names)
                    salary('parts', part_salaries, {{years}}, null, null, from, to, part_names)


                }

            }

        });



        $("#amount").val(a + " год" + "-" + b + " год");

    });


    $("#whithout").click(function() {
        window.mode = 'wh'
        savings('wh', [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)
        flat('wh', [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)
        cars('wh', [10, 20, 30, 40, 25, 32, 44, 33, 32, 32, 40], {{years}}, null, null, window.from, window.to, null)
        salary('wh', {{avarage_salary}}, {{years}}, null, null, window.from, window.to, null)
    })
    $("#genders").click(function() {
        mode = 'mw'
        from = window.from
        to = window.to

        window.mode = mode
        savings(mode, null, {{years | safe}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, from, to, null)
        flat(mode, null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, from, to, null)
        cars(mode, null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, from, to, null)
        salary(mode, null, {{years}}, {{m_avarage_salary | safe}}, {{w_avarage_salary | safe}}, from, to, null)
    })

    $("#parts").click(function() {
        var part_names = {{part_names | safe}}
        part_salaries = {{part_salaries | safe}}


        window.mode = 'part'
        savings('parts', part_salaries, {{years}}, null, null, from, to, part_names)
        flat('parts', part_salaries, {{years}}, null, null, from, to, part_names)
        cars('parts', part_salaries, {{years}}, null, null, from, to, part_names)

        salary('parts', part_salaries, {{years}}, null, null, from, to, part_names)
    })


</script>
{% endblock %}
